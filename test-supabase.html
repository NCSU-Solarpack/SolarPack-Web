<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase Connection Test</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    .result {
      background: #2a2a2a;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid #4CAF50;
    }
    .error {
      border-left-color: #f44336;
    }
    .success {
      border-left-color: #4CAF50;
    }
    button {
      background: #E31820;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #c71821;
    }
    pre {
      background: #000;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 14px;
      margin-left: 10px;
    }
    .status.ok {
      background: #4CAF50;
      color: white;
    }
    .status.error {
      background: #f44336;
      color: white;
    }
  </style>
</head>
<body>
  <h1>üîå Supabase Connection Test</h1>
  
  <div id="config-check" class="result">
    <h3>Configuration Check</h3>
    <p id="config-status">Checking...</p>
  </div>

  <div id="connection-test" class="result">
    <h3>Database Connection Test</h3>
    <button onclick="testConnection()">Test Connection</button>
    <button onclick="testTeamMembers()">Fetch Team Members</button>
    <button onclick="addTestMember()">Add Test Member</button>
    <div id="connection-result"></div>
  </div>

  <div id="tables-check" class="result">
    <h3>Tables Check</h3>
    <button onclick="checkTables()">Verify Tables Exist</button>
    <div id="tables-result"></div>
  </div>

  <script type="module">
    import { supabaseService } from '/src/utils/supabase.js';
    
    // Make available globally for button clicks
    window.supabaseService = supabaseService;
    
    // Check configuration on load
    const configStatus = document.getElementById('config-status');
    const isConfigured = supabaseService.isConfigured();
    
    if (isConfigured) {
      configStatus.innerHTML = `
        <span class="status ok">‚úì CONFIGURED</span>
        <p>Supabase client is properly initialized!</p>
        <pre>${JSON.stringify({
          url: import.meta.env.VITE_SUPABASE_URL ? '‚úì Set' : '‚úó Missing',
          anonKey: import.meta.env.VITE_SUPABASE_ANON_KEY ? '‚úì Set' : '‚úó Missing'
        }, null, 2)}</pre>
      `;
    } else {
      configStatus.innerHTML = `
        <span class="status error">‚úó NOT CONFIGURED</span>
        <p>Check your .env file!</p>
      `;
    }

    window.testConnection = async function() {
      const resultDiv = document.getElementById('connection-result');
      resultDiv.innerHTML = '<p>Testing connection...</p>';
      
      try {
        const { data, error } = await supabaseService.client
          .from('team_members')
          .select('count');
        
        if (error) throw error;
        
        resultDiv.innerHTML = `
          <span class="status ok">‚úì CONNECTION SUCCESSFUL</span>
          <p>Successfully connected to Supabase database!</p>
        `;
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">‚úó CONNECTION FAILED</span>
          <p>${error.message}</p>
          <pre>${JSON.stringify(error, null, 2)}</pre>
        `;
      }
    };

    window.testTeamMembers = async function() {
      const resultDiv = document.getElementById('connection-result');
      resultDiv.innerHTML = '<p>Fetching team members...</p>';
      
      try {
        const data = await supabaseService.getTeamMembers();
        resultDiv.innerHTML = `
          <span class="status ok">‚úì SUCCESS</span>
          <p>Found ${data.teamMembers.length} team member(s)</p>
          <pre>${JSON.stringify(data, null, 2)}</pre>
        `;
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">‚úó ERROR</span>
          <p>${error.message}</p>
          <pre>${JSON.stringify(error, null, 2)}</pre>
        `;
      }
    };

    window.addTestMember = async function() {
      const resultDiv = document.getElementById('connection-result');
      resultDiv.innerHTML = '<p>Adding test member...</p>';
      
      try {
        const testMember = {
          name: 'Test User',
          role: 'Test Role',
          bio: 'This is a test member added via Supabase',
          order: 999
        };
        
        const result = await supabaseService.saveTeamMember(testMember);
        resultDiv.innerHTML = `
          <span class="status ok">‚úì MEMBER ADDED</span>
          <p>Successfully added test member!</p>
          <pre>${JSON.stringify(result, null, 2)}</pre>
          <p style="color: #4CAF50;">Now click "Fetch Team Members" to see it!</p>
        `;
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">‚úó ERROR</span>
          <p>${error.message}</p>
          <pre>${JSON.stringify(error, null, 2)}</pre>
        `;
      }
    };

    window.checkTables = async function() {
      const resultDiv = document.getElementById('tables-result');
      resultDiv.innerHTML = '<p>Checking tables...</p>';
      
      const tables = ['team_members', 'alumni', 'sponsors', 'schedules', 'orders'];
      const results = [];
      
      for (const table of tables) {
        try {
          const { data, error } = await supabaseService.client
            .from(table)
            .select('count')
            .limit(1);
          
          if (error) {
            results.push(`<li>‚ùå ${table} - <span style="color: #f44336">${error.message}</span></li>`);
          } else {
            results.push(`<li>‚úÖ ${table} - <span style="color: #4CAF50">exists</span></li>`);
          }
        } catch (err) {
          results.push(`<li>‚ùå ${table} - <span style="color: #f44336">${err.message}</span></li>`);
        }
      }
      
      resultDiv.innerHTML = `
        <h4>Table Status:</h4>
        <ul style="list-style: none; padding-left: 0;">
          ${results.join('')}
        </ul>
      `;
    };
  </script>
</body>
</html>
